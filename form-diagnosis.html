<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Datos de Diagn√≥stico</title>
  <link rel="stylesheet" href="../css/form-diagnostico.css">

  <!-- üîπ Librer√≠a Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <div class="container">
    <h1>Datos de Diagn√≥stico</h1>

    <form id="formDiagnostico" onsubmit="return validarFormulario(event)">
      <!-- Resultados m√©dicos -->
      <div class="form-group">
        <label for="resultados">Resultados m√©dicos:</label>
        <div class="tag-container" id="listaResultados"></div>
        <input type="text" id="resultados" placeholder="Escribe un resultado y presiona Enter">
      </div>

      <!-- Ex√°menes programados -->
      <div class="form-group">
        <label for="examenes">Ex√°menes programados:</label>
        <div class="tag-container" id="listaExamenes"></div>
        <input type="text" id="examenes" placeholder="Escribe un examen y presiona Enter">
      </div>

      <!-- Tratamiento / indicaciones -->
      <div class="form-group">
        <label for="tratamiento">Tratamiento / indicaciones:</label>
        <div class="tag-container" id="listaTratamiento"></div>
        <input type="text" id="tratamiento" placeholder="Escribe una indicaci√≥n y presiona Enter">
      </div>

      <!-- Pr√≥xima cita -->
      <div class="form-group">
        <label for="fecha">Pr√≥xima cita:</label>
        <input type="text" id="fecha" placeholder="Selecciona una fecha">
      </div>

      <button type="submit" class="btn-guardar">Guardar</button>
    </form>
  </div>

  <script>
    // üîπ Crea listas din√°micas (tags)
    function crearListaDinamica(inputId, listaId) {
      const input = document.getElementById(inputId);
      const lista = document.getElementById(listaId);

      input.addEventListener('keydown', function (event) {
        if (event.key === 'Enter' && input.value.trim() !== '') {
          event.preventDefault();
          const valor = input.value.trim();

          const tag = document.createElement('div');
          tag.className = 'tag';
          tag.textContent = valor;

          const close = document.createElement('span');
          close.textContent = '√ó';
          close.className = 'close';
          close.onclick = () => tag.remove();

          tag.appendChild(close);
          lista.appendChild(tag);

          input.value = '';
        }
      });
    }

    crearListaDinamica('resultados', 'listaResultados');
    crearListaDinamica('examenes', 'listaExamenes');
    crearListaDinamica('tratamiento', 'listaTratamiento');

    // üîπ Inicializar Flatpickr para calendario bonito
    flatpickr("#fecha", {
  enableTime: true,               // Activa selecci√≥n de hora
  time_24hr: true,                // Formato 24 horas (sin AM/PM)
  dateFormat: "d/m/Y H:i",        // Formato interno (para guardar)
  altInput: true,
  altFormat: "l, d \\d\\e F \\d\\e Y - H:i", // Formato visual
  locale: {
    firstDayOfWeek: 1,
    weekdays: {
      shorthand: ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'],
      longhand: [
        'Domingo', 'Lunes', 'Martes', 'Mi√©rcoles',
        'Jueves', 'Viernes', 'S√°bado'
      ]
    },
    months: {
      shorthand: [
        'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
        'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'
      ],
      longhand: [
        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
      ]
    }
  },
  minDate: "today",
  disableMobile: true
});

    // üîπ Validaci√≥n del formulario
    function validarFormulario(event) {
      event.preventDefault();

      const resultados = document.querySelectorAll('#listaResultados .tag').length;
      const examenes = document.querySelectorAll('#listaExamenes .tag').length;
      const tratamientos = document.querySelectorAll('#listaTratamiento .tag').length;
      const fecha = document.getElementById('fecha').value;

      if (resultados === 0 || examenes === 0 || tratamientos === 0) {
        alert("‚ö†Ô∏è Debes agregar al menos un elemento en cada apartado (resultados, ex√°menes y tratamiento).");
        return false;
      }

      if (!fecha) {
        alert("‚ö†Ô∏è Debes seleccionar la fecha de la pr√≥xima cita.");
        return false;
      }

      alert("‚úÖ Datos de diagn√≥stico guardados correctamente.");
      document.getElementById('formDiagnostico').reset();
      document.querySelectorAll('.tag-container').forEach(div => div.innerHTML = '');
    }
  </script>
</body>
</html>
